import{a as E}from"./chunk-JABFKQED.js";import{a as ee,b as te,c as oe}from"./chunk-D7SN5KTM.js";import{a as Z}from"./chunk-I5OIH6PH.js";import{a as X}from"./chunk-INQT764L.js";import"./chunk-GELGV6ZH.js";import"./chunk-RH5UTBKV.js";import"./chunk-DHTC2TTF.js";import{a as W}from"./chunk-DUBUWPD2.js";import{i as J}from"./chunk-PBA57O2B.js";import"./chunk-CEWKWK6U.js";import"./chunk-DNPQSKTC.js";import{a as K}from"./chunk-OWCWUQTL.js";import{A as R,C as G,h as Y,k as P}from"./chunk-TNPE2B44.js";import{$ as g,Aa as A,Ab as f,Eb as x,Ib as u,Jb as h,Nb as C,Ob as v,Pa as F,Pb as b,Qb as q,Rb as m,Sb as j,Tb as $,Va as c,Wa as k,Zb as Q,_b as V,ea as y,fc as M,gc as I,lb as T,na as d,oa as l,pb as _,sb as N,tc as U,ub as L,vb as z,wa as S,wb as D,xb as O,yb as s,zb as r}from"./chunk-MFMNMFCO.js";import{a as B,b as H}from"./chunk-DM275RSA.js";var ce=["chartContainer"],ne=(()=>{class n{constructor(){this.actionTriggeredB=new S,this.currentQuestionArr=[],this.currentQuestionArrAppended=[],this.data=[],this.isChartRendered=!1,this.currentQuestion=null,this.isRendered=!0,this.currentChartsIdPrev=[],this._CurrentQuestionsService=g(E)}ngOnInit(){this._CurrentQuestionsService.currentQuestions.subscribe({next:e=>{this.AllQuestions=e}}),this._CurrentQuestionsService.currentData.subscribe(e=>{this.currentQuestionArr=e,this.currentQuestionArr.length>0&&this.isRendered&&setTimeout(()=>{this.renderChart(),this.isRendered=!1},200)})}ngOnDestroy(){this._CurrentQuestionsService.updateData([])}startNode(){this.currentQuestionArrAppended.push(this.AllQuestions[0]),this.data.push({id:"root",name:this.currentQuestionArr[0].charts[0].title,parentId:null,collapsed:!1,isNewNode:!1}),this.currentQuestionArr[0].choices.forEach(e=>{this.data.push({id:e.next_question_id.toString(),name:e.text,parentId:"root",collapsed:!1,isNewNode:!1})})}renderChart(){this.isChartRendered||(this.startNode(),this.chart=new oe,this.isChartRendered=!0),this.chart.container(this.chartContainer.nativeElement).data(this.data).nodeWidth(e=>250).nodeHeight(e=>{let a=e.data.name.length,p=Math.ceil(a/30);return Math.max(180,180+p*20)}).childrenMargin(e=>30).siblingsMargin(e=>80).nodeContent(e=>this.getCustomNodeHTML(e)).nodeButtonY(e=>10).onNodeClick(e=>this.onNodeClick(e)).linkYOffset(1).compact(!1).layout("top").render(),this.isChartRendered=!0}onNodeClick(e){console.log("Node clicked:",e),this.appendChildNode(e);let o=+this.currentChoiceId;this.currentChoiceId=+e.id;let t=document.querySelector(`[value="${o}"]`);t&&!t.checked&&t.click()}getCustomNodeHTML(e){return`
        <div data-attr="${e.data.id}" title="${e.data.name}" class="title__fonts__normal overflow-hidden custom-node position-relative d-flex justify-content-center align-items-center w-auto text-dark"
        style="word-wrap: break-word; background-color:#e8f5fc; border-color:#409bd2; padding: 10px; height: 100%;">
          <div style="width: 230px; word-break: break-word;">
            <label class="node-header " style="font-weight:300; font-family: 'Montserrat', sans-serif; margin: 0;">${e.data.name}</label>
          </div>
        </div>
      `}appendChildNode(e){this.currentChoiceId=e.id;let o=this.currentQuestionArr.find(t=>t.id.toString()==e.id);if(console.log(e),!!this.currentQuestionArr.includes(o)){if(o&&o.choices)if(document.getElementById("copy")?.classList.add("d-none"),document.getElementById("responsive_copy")?.classList.add("d-none"),o.choices.length>0){let t=o.charts[0].id.toString();this.updateChart(t,o.charts[0].title,e.id.toString(),!0),o.choices.forEach(i=>{console.log(o.id.toString());let a=e.id;this.updateChart(i.next_question_id.toString(),i.text,t,!1)})}else o.charts.forEach((t,i)=>{let a=o.charts.length,p=!1;i==0?p=!0:p=Math.floor(a/2)==i+1,this.updateChart(t.id.toString(),t.title,e.id,p)}),document.getElementById("copy")?.classList.remove("d-none"),document.getElementById("responsive_copy")?.classList.remove("d-none");this.chart.expandAll(),this.collapse(e)}}updateChart(e,o,t,i){this.chart.addNode({id:e,name:o,parentId:t,collapsed:!1,isNewNode:!0}).render(),i&&this.chart.setCentered(e)}collapse(e){let o=[];this.currentQuestionArr.forEach(t=>{t.charts.forEach(i=>{o.push(i.id),this.currentChartsIdPrev.push(i.id)})}),this.currentChartsIdPrev.forEach(t=>{o.includes(t)||(this.chart.removeNode(t),this.currentChartsIdPrev=o)})}static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275cmp=y({type:n,selectors:[["app-protocol-questions-flow-charts"]],viewQuery:function(o,t){if(o&1&&C(ce,7),o&2){let i;v(i=b())&&(t.chartContainer=i.first)}},outputs:{actionTriggeredB:"actionTriggeredB"},standalone:!0,features:[Q],decls:2,vars:0,consts:[["chartContainer",""],[1,"chart-container","w-100"]],template:function(o,t){o&1&&f(0,"div",1,0)},styles:['.chart-container[_ngcontent-%COMP%]{width:100%;max-height:80vh;overflow-y:scroll;overflow:hidden}  .svg-chart-container{width:100%}  .custom-node{border:1px solid #ccc;border-radius:8px;box-shadow:0 4px 8px #0000001a;text-align:center;font-family:"Arial, sans-serif";fill:#e8f5fc;stroke:#409bd2;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:10px;word-wrap:break-word;height:auto;position:relative}  .custom-node .node-header{font-weight:700;font-size:14px;cursor:pointer}  .custom-node .node-header::selection,   .custom-node .node-header *::selection{background-color:transparent}  .custom-node .node-subtitle{font-size:12px;color:#555;white-space:normal}  .custom-node .node-buttons{display:flex;justify-content:center;gap:10px;margin-top:auto}  .custom-node.active{border:2px solid #4caf50;background-color:#e8f5e9}  .node-button{padding:5px 10px;border:none;background-color:#4caf50;color:#fff;font-size:14px;border-radius:5px;cursor:pointer}  .node-button:hover{background-color:#45a049}  .orgchart .node .toggle{display:none}  .orgchart .node .toggle{pointer-events:none;opacity:.5}  ul{padding-left:10px}  .highlight-node{background-color:#ff0;border:2px solid red;transition:all .3s ease}  .highlight-path{stroke:red!important;stroke-width:4px!important;transition:stroke .3s ease}  .node-button-g{display:none}  .node-button-g{position:absolute;top:0;left:0}  .form-check-input:checked{background-color:#2490eb!important;box-shadow:none}  .form-check-input{border-radius:50%!important}  .org-path{stroke:#ccc;stroke-width:2;transition:stroke .3s ease}  path.link{fill:none;stroke:#ccc;stroke-width:2;position:relative}  .custom-node{position:relative}  .custom-node:before{content:"";position:absolute;right:50px;top:50%;transform:translateY(50%);border-radius:50%;width:16px;height:16px}.node-header[_ngcontent-%COMP%]     p{white-space:normal!important;word-wrap:break-word!important;width:100%;overflow-wrap:break-word;text-align:center;padding:.5rem;line-height:1.4}.node-header[_ngcontent-%COMP%]{display:block;width:100%;font-weight:300;font-family:Montserrat,sans-serif;word-break:break-word;white-space:normal!important}.node-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;padding:.5rem;line-height:1.4;text-align:center;white-space:normal!important;word-wrap:break-word!important;width:100%;overflow-wrap:break-word}']})}}return n})();var de=["Questions__Description"],le=["Question"];function ue(n,w){return this.currentQuestionArr}function pe(n,w){if(n&1){let e=x();s(0,"div",9)(1,"div",10)(2,"input",11),u("change",function(){let t=d(e).$implicit,i=h().$implicit,a=h(2);return a.onCheckPreviousQuestionCheck(i),a.onDisplayNextQuestionChange(t.next_question_id),a.updateChart(t.id,t.next_question_id),l(a.onChangeMoving())}),r(),s(3,"label",12),m(4),r()()()}if(n&2){let e=w.$implicit;c(2),_("id",e.id)("value",e.next_question_id)("name",e.question_id),c(),_("for",e.id),c(),j(e.text)}}function he(n,w){if(n&1&&(s(0,"div",4,1)(2,"div",5),f(3,"div",8),M(4,"safeHtml"),s(5,"form"),D(6,pe,5,5,"div",9,z),r()()()),n&2){let e=w.$implicit;c(3),_("innerHTML",I(4,1,e.description),F),c(3),O(e.choices)}}function me(n,w){if(n&1&&(s(0,"div",2)(1,"div",3,0)(3,"div",4,1)(5,"div",5)(6,"div",6),f(7,"i",7),m(8),M(9,"date"),r(),f(10,"div",8),M(11,"safeHtml"),r()(),D(12,he,8,3,"div",4,ue,!0),r()()),n&2){let e=h();c(8),$(" last updated ",I(9,2,e.specificProtocol.protocol.updated_at)," "),c(2),_("innerHTML",I(11,4,e.specificProtocol.protocol.description),F),c(2),O(e.currentQuestionArr)}}var re=(()=>{class n{constructor(){this.actionTriggeredA=new S,this.currentQuestionArr=[],this._ActivatedRoute=g(R),this._SpecificProtocolService=g(X),this._CurrentQuestionsService=g(E),this.cdr=g(U),this._HistoryProtocolsService=g(Z),this._PLATFORM_ID=g(A)}ngOnInit(){P(this._PLATFORM_ID)&&(this.currentUserId=+localStorage.getItem("userId"),this.SendPatient=JSON.parse(localStorage.getItem("PatientData"))),this.handleGetCurrentCategoryId(),this.getCurrentCategory()}ngOnDestroy(){this._HistoryProtocolsService.History.next(null),P(this._PLATFORM_ID)&&localStorage.removeItem("PatientData")}handleGetCurrentCategoryId(){this._ActivatedRoute.paramMap.subscribe({next:e=>{this.protocolId=e.get("id")}})}getCurrentCategory(){this.specificProtocol=this._ActivatedRoute.snapshot.data.questions,this._CurrentQuestionsService.updateQuestions(this.specificProtocol.protocol.questions),P(this._PLATFORM_ID)&&localStorage.setItem("sub_category_id",this.specificProtocol.protocol.sub_category_id.toString())}displayFirstQuestion(){let e=this.specificProtocol.protocol.questions[0];this.currentQuestionArr.push(e),this._CurrentQuestionsService.updateData(this.currentQuestionArr)}onDisplayNextQuestionChange(e){let o=this.specificProtocol.protocol.questions.find(t=>t.id===e);o&&this.currentQuestionArr.push(o),this._CurrentQuestionsService.updateData(this.currentQuestionArr)}addToHistory(e){let o;this.SendPatient?(console.log(this.SendPatient),o=H(B({},this.SendPatient),{protocol_id:this.protocolId,user_id:this.currentUserId.toString()}),this._HistoryProtocolsService.addToHistoryPatient(o,e.id).subscribe({next:t=>{console.log(t)},error:t=>{console.log(t)}})):(o=e,this._HistoryProtocolsService.addToHistory(o).subscribe({next:t=>{console.log(t)},error:t=>{console.log(t)}})),console.log(o)}onCheckPreviousQuestionCheck(e){let o=this.currentQuestionArr.indexOf(e);if(o!==-1){let t=this.currentQuestionArr.splice(o+1);console.log(t),t.forEach(i=>{i.choices.forEach(a=>{document.querySelectorAll(`[for="${a.id}"]`).forEach(se=>{let ae=se.previousSibling;ae.checked=!1})})}),this._CurrentQuestionsService.updateData(this.currentQuestionArr)}}updateChart(e,o){this._CurrentQuestionsService.updateData(this.currentQuestionArr),this.actionTriggeredA.emit({id:o}),this.addToHistory({user_id:this.currentUserId.toString(),id:e})}onChangeMoving(){setTimeout(()=>{this.cdr.detectChanges(),console.log(this.Question.last.nativeElement),this.Question.last.nativeElement.scrollIntoView({behavior:"smooth",block:"nearest"})},0)}static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275cmp=y({type:n,selectors:[["app-protocol-questions-flow-radios"]],viewQuery:function(o,t){if(o&1&&(C(de,5),C(le,5)),o&2){let i;v(i=b())&&(t.Questions__Description=i.first),v(i=b())&&(t.Question=i)}},outputs:{actionTriggeredA:"actionTriggeredA"},standalone:!0,features:[Q],decls:1,vars:1,consts:[["Questions__Description",""],["Question",""],["id","Questions__Container",1,"position-relative","z-1","p-2"],["id","Questions__Description"],[1,"card","mb-2"],[1,"card-body","rounded-0"],[1,"lastUpdated__text"],[1,"pi","pi-history"],[3,"innerHTML"],["id","Questions__Choices"],[1,"form-check"],["type","radio",1,"form-check-input",3,"change","id","value","name"],[1,"form-check-label",3,"for"]],template:function(o,t){o&1&&T(0,me,14,6,"div",2),o&2&&L(0,t.specificProtocol?0:-1)},dependencies:[Y,K],styles:["body{overflow-y:hidden}[_nghost-%COMP%]{height:calc(100% - 56px);overflow-y:auto}.lastUpdated__text[_ngcontent-%COMP%], .lastUpdated__text[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{text-align:right;font-size:14px;color:#757575;line-height:24px;margin-bottom:1rem}.card-body[_ngcontent-%COMP%]{background-color:#e8f5fc;border:2px solid #409bd2;padding:16px;position:relative}.card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_Animation__Card 1s forwards}@keyframes _ngcontent-%COMP%_Animation__Card{0%{transform:translateY(10px);opacity:0}to{transform:translateY(0);opacity:1}}.card-body.rounded-0[_ngcontent-%COMP%]     div{word-break:break-word;white-space:normal;max-width:100%}"]})}}return n})();var ge=["componentB"],_e=["componentA"],fe=()=>({height:"90vh"}),Ce=()=>[50,50];function ve(n,w){if(n&1){let e=x();s(0,"div",16)(1,"div")(2,"div",17)(3,"app-protocol-questions-flow-charts",18,2),u("actionTriggeredB",function(t){d(e);let i=h();return l(i.handleActionB(t))}),r()()()()}}function be(n,w){if(n&1){let e=x();s(0,"div",19)(1,"div",8)(2,"div",9)(3,"app-protocol-questions-flow-radios",10,0),u("actionTriggeredA",function(t){d(e);let i=h();return l(i.handleActionA(t))}),r(),s(5,"div",11)(6,"button",12),u("click",function(){d(e);let t=q(4),i=h();return t.displayFirstQuestion(),t.onChangeMoving(),l(i.isDisabled=!0)}),m(7," Start "),r(),s(8,"button",20),u("click",function(){d(e);let t=h();return l(t.copy())}),f(9,"i",14),m(10," copy Assessment "),r(),s(11,"button",15),u("click",function(){d(e);let t=h();return l(t.showRelatedProtocols())}),m(12," Related Content "),r()()()()()}if(n&2){let e=h();c(6),_("disabled",e.isDisabled)}}var it=(()=>{class n{constructor(e,o,t,i){this._ToastrService=e,this._ActivatedRoute=o,this._Router=t,this._PLATFORM_ID=i,this.isDisabled=!1}handleGetCurrentCategoryId(){this._ActivatedRoute.paramMap.subscribe({next:e=>{this.protocolId=e.get("id")}})}showRelatedProtocols(){if(P(this._PLATFORM_ID)){let e=localStorage.getItem("sub_category_id");this._Router.navigate([`/protocols/sub-protocols-categories/${e}`])}}handleActionB(e){this.componentB.onCheckPreviousQuestionCheck(e.Question),this.componentB.onDisplayNextQuestionChange(e.Choice),console.log("works")}handleActionA(e){this.componentA.onNodeClick(e),console.log("works")}copy(){let e=document.querySelector("#Questions__Description")?.lastElementChild;navigator.clipboard.writeText(e.innerText),this._ToastrService.success("Assessment Copied")}static{this.\u0275fac=function(o){return new(o||n)(k(W),k(R),k(G),k(A))}}static{this.\u0275cmp=y({type:n,selectors:[["app-protocol-questions-page"]],viewQuery:function(o,t){if(o&1&&(C(ge,5),C(_e,5)),o&2){let i;v(i=b())&&(t.componentB=i.first),v(i=b())&&(t.componentA=i.first)}},standalone:!0,features:[Q],decls:19,vars:6,consts:[["componentB",""],["copying",""],["componentA",""],[1,"card","d-none","d-lg-block"],["styleClass","mb-5",3,"panelSizes"],["pTemplate",""],[1,"card",2,"height","100vh","padding-top","120px"],[1,"col","flex","align-items-center","justify-content-center","h-100","d-block","d-lg-none"],[1,"h-100"],[1,"Questions__Container","bg-white","h-100","w-100","d-flex","flex-column","justify-content-end"],[3,"actionTriggeredA"],[2,"background-color","#ededed","height","56px"],["id","start",1,"btn","btn-main","m-2","rounded-0",3,"click","disabled"],["id","responsive_copy",1,"btn","btn-main","m-2","rounded-0","d-none",3,"click"],[1,"pi","pi-copy"],[1,"btn","btn-main","m-2","rounded-0",3,"click"],[1,"col","flex","align-items-center","justify-content-center"],[1,"p-2","bg-white","h-100","w-100"],[3,"actionTriggeredB"],[1,"col","flex","align-items-center","justify-content-center","h-100"],["id","copy",1,"btn","btn-main","m-2","rounded-0","d-none",3,"click"]],template:function(o,t){if(o&1){let i=x();s(0,"div",3)(1,"p-splitter",4),T(2,ve,5,0,"ng-template",5)(3,be,13,1,"ng-template",5),r()(),s(4,"div",6)(5,"div",7)(6,"div",8)(7,"div",9)(8,"app-protocol-questions-flow-radios",10,0),u("actionTriggeredA",function(p){return d(i),l(t.handleActionA(p))}),r(),s(10,"div",11)(11,"button",12),u("click",function(){d(i);let p=q(9);return p.displayFirstQuestion(),p.onChangeMoving(),l(t.isDisabled=!0)}),m(12," Start "),r(),s(13,"button",13,1),u("click",function(){return d(i),l(t.copy())}),f(15,"i",14),m(16," copy Assessment "),r(),s(17,"button",15),u("click",function(){return d(i),l(t.showRelatedProtocols())}),m(18," Related Content "),r()()()()()()}o&2&&(c(),N(V(4,fe)),_("panelSizes",V(5,Ce)),c(10),_("disabled",t.isDisabled))},dependencies:[re,ne,te,ee,J],styles:[".card[_ngcontent-%COMP%]{padding-top:80px;background-color:#ededed}  .p-splitter-gutter.ng-star-inserted{padding:5px;background-color:#ededed;background-image:url(/assets/sizeable.png);background-position:center center;background-repeat:no-repeat}  .p-splitter-gutter-handle{display:none}  #resizable{min-width:100px;min-height:100px;background-color:#ededed;position:relative}  .resizable-box{width:100%;height:150px;background-color:#ededed;resize:both;overflow:auto;border:1px solid black}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{transition:background-color .3s cubic-bezier(.4,0,.2,1);transition:color .3s cubic-bezier(.4,0,.2,1);transition-delay:0ms;transition-property:color,background-color,border;appearance:none;background-color:#007ac3;border:.0625rem solid transparent;border-radius:0;box-sizing:border-box;color:#fff;display:inline-block;font-size:.875rem;font-weight:400;line-height:1.29;padding:.625rem 1rem;-webkit-tap-highlight-color:transparent;text-align:center;touch-action:manipulation;vertical-align:middle}"]})}}return n})();export{it as ProtocolQuestionsPageComponent};
