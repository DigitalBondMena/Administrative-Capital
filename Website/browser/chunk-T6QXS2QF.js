import{a as J,b as W,c as B}from"./chunk-D7SN5KTM.js";import{a as G}from"./chunk-OCF5X673.js";import{a as U}from"./chunk-K6RZMIC6.js";import"./chunk-GELGV6ZH.js";import"./chunk-RH5UTBKV.js";import"./chunk-DHTC2TTF.js";import{a as $}from"./chunk-DUBUWPD2.js";import{i as j}from"./chunk-PBA57O2B.js";import"./chunk-NPMQALXN.js";import"./chunk-DNPQSKTC.js";import{a as Y}from"./chunk-OWCWUQTL.js";import{A as L,h as V,k as z}from"./chunk-TNPE2B44.js";import{Aa as D,Ab as p,Eb as x,Ib as f,Jb as c,Nb as g,Ob as _,Pa as M,Pb as y,Rb as b,Sb as R,Tb as F,Va as r,Wa as v,Zb as w,_b as q,ea as C,fc as k,gc as T,lb as P,na as h,oa as m,pb as l,sb as N,ub as A,vb as O,wa as H,wb as E,xb as I,yb as a,zb as s}from"./chunk-MFMNMFCO.js";import"./chunk-DM275RSA.js";var et=["chartContainer"],K=(()=>{class o{constructor(){this.actionTriggeredB=new H,this.currentQuestionArr=[],this.data=[],this.chart=new B,this.isChartRendered=!1,this.currentChartsIdPrev=[]}ngOnInit(){this.actionTriggeredB.emit({})}startNode(){console.log(this.specificProtocol,"Start Node"),this.data.push({id:"root",name:this.specificProtocol.protocol.questions[0].title,parentId:null,collapsed:!1,isNewNode:!1}),this.specificProtocol.protocol.questions[0].choices.forEach(t=>{this.data.push({id:t.next_question_id.toString(),name:t.text,parentId:"root",collapsed:!1,isNewNode:!1})}),console.log(this.currentQuestionArr),setTimeout(()=>{console.log(this.specificProtocol.protocol.questions[0].id,"this.specificProtocol.protocol.questions[0].id"),this.currentQuestionArr.forEach((t,e)=>{t.id!=this.specificProtocol.protocol.questions[0].id&&this.onNodeClick({id:t.id})})},500)}renderChart(){this.isChartRendered||(this.startNode(),this.chart=new B,this.isChartRendered=!0);let t=i=>{let Q=i.length,S=Math.ceil(Q/30);return Math.max(200,200+S*20)},e=Math.max(...this.data.map(i=>t(i.name)));this.chart.container(this.chartContainer.nativeElement).data(this.data).nodeWidth(i=>250).nodeHeight(i=>e).childrenMargin(i=>80).siblingsMargin(i=>80).nodeContent(i=>this.getCustomNodeHTML(i,e)).nodeButtonY(i=>10).onNodeClick(i=>this.onNodeClick(i)).linkYOffset(1).compact(!1).layout("top").render(),this.isChartRendered=!0}onNodeClick(t){console.log("Node clicked:",t),this.appendChildNode(t)}getCustomNodeHTML(t,e){return`
        <div data-attr="${t.data.id}" class="title__fonts__normal custom-node position-relative d-flex justify-content-center align-items-center w-auto text-dark"
        style="word-wrap: break-word; background-color:#e8f5fc; border-color:#409bd2; padding: 10px; height: ${e}px;">
          <div style="width: 230px; word-break: break-word;">
            <label class="node-header" style="font-weight:300; font-family: 'Montserrat', sans-serif; margin: 0;">${t.data.name}</label>
          </div>
        </div>
      `}appendChildNode(t){this.currentChoiceId=t.id;let e=this.currentQuestionArr.find(i=>i.id.toString()==t.id);if(this.currentQuestionArr.includes(e)){if(e&&e.choices)if(document.getElementById("copy")?.classList.add("d-none"),document.getElementById("responsive_copy")?.classList.add("d-none"),e.choices.length>0){let i=e.charts[0].id.toString();this.updateChart(i,e.charts[0].title,t.id.toString(),!0),e.choices.forEach(n=>{let d=t.id;this.updateChart(n.next_question_id.toString(),n.text,i,!1)})}else document.getElementById("copy")?.classList.remove("d-none"),document.getElementById("responsive_copy")?.classList.remove("d-none"),e.charts.forEach((i,n)=>{let d=e.charts.length,Q=Math.floor(d/2)==n+1;this.updateChart(i.id.toString(),i.title,t.id,Q)});this.chart.expandAll()}}updateChart(t,e,i,n){this.chart.addNode({id:t,name:e,parentId:i,collapsed:!1,isNewNode:!0}).render(),n&&this.chart.fit().render()}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=C({type:o,selectors:[["app-patient-history-flow-charts"]],viewQuery:function(e,i){if(e&1&&g(et,7),e&2){let n;_(n=y())&&(i.chartContainer=n.first)}},inputs:{currentQuestionArr:"currentQuestionArr",specificProtocol:"specificProtocol"},outputs:{actionTriggeredB:"actionTriggeredB"},standalone:!0,features:[w],decls:2,vars:0,consts:[["chartContainer",""],[1,"chart-container","w-100"]],template:function(e,i){e&1&&p(0,"div",1,0)},styles:['.chart-container[_ngcontent-%COMP%]{width:100%;overflow-y:scroll;overflow:hidden}  .svg-chart-container{width:100%}  .custom-node{border:1px solid #ccc;border-radius:8px;box-shadow:0 4px 8px #0000001a;text-align:center;font-family:"Arial, sans-serif";fill:#e8f5fc;stroke:#409bd2;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:10px;word-wrap:break-word;height:auto;position:relative}  .custom-node .node-header{font-weight:700;font-size:14px;cursor:pointer}  .custom-node .node-header::selection,   .custom-node .node-header *::selection{background-color:transparent}  .custom-node .node-subtitle{font-size:12px;color:#555;white-space:normal}  .custom-node .node-buttons{display:flex;justify-content:center;gap:10px;margin-top:auto}  .custom-node.active{border:2px solid #4caf50;background-color:#e8f5e9}  .node-button{padding:5px 10px;border:none;background-color:#4caf50;color:#fff;font-size:14px;border-radius:5px;cursor:pointer}  .node-button:hover{background-color:#45a049}  .orgchart .node .toggle{display:none}  .orgchart .node .toggle{pointer-events:none;opacity:.5}  ul{padding-left:10px}  .highlight-node{background-color:#ff0;border:2px solid red;transition:all .3s ease}  .highlight-path{stroke:red!important;stroke-width:4px!important;transition:stroke .3s ease}  .node-button-g{display:none}  .node-button-g{position:absolute;top:0;left:0}  .form-check-input:checked{background-color:#2490eb!important;box-shadow:none}  .form-check-input{border-radius:50%!important}  .org-path{stroke:#ccc;stroke-width:2;transition:stroke .3s ease}  path.link{fill:none;stroke:#ccc;stroke-width:2;position:relative}  .custom-node{position:relative}  .custom-node:before{content:"";position:absolute;right:50px;top:50%;transform:translateY(50%);border-radius:50%;width:16px;height:16px;border:1px solid #cccs}']})}}return o})();var it=["Questions__Description"],ot=["Question"];function nt(o,u){return this.currentQuestionArr}function rt(o,u){if(o&1){let t=x();a(0,"div",9)(1,"div",10)(2,"input",11),f("change",function(){let i=h(t).$implicit,n=c().$implicit,d=c(2);return d.onCheckPreviousQuestionCheck(n),d.onDisplayNextQuestionChange(i.next_question_id),d.updateChart(i.next_question_id),m(d.onChangeMoving())}),s(),a(3,"label",12),b(4),s()()()}if(o&2){let t=u.$implicit;r(2),l("id",t.id)("value",t.next_question_id)("name",t.question_id),r(),l("for",t.id),r(),R(t.text)}}function st(o,u){if(o&1&&(a(0,"div",4,1)(2,"div",5),p(3,"div",8),k(4,"safeHtml"),a(5,"form"),E(6,rt,5,5,"div",9,O),s()()()),o&2){let t=u.$implicit;r(3),l("innerHTML",T(4,1,t.description),M),r(3),I(t.choices)}}function at(o,u){if(o&1&&(a(0,"div",2)(1,"div",3,0)(3,"div",4,1)(5,"div",5)(6,"div",6),p(7,"i",7),b(8),k(9,"date"),s(),p(10,"div",8),k(11,"safeHtml"),s()(),E(12,st,8,3,"div",4,nt,!0),s()()),o&2){let t=c();r(8),F(" last updated ",T(9,2,t.specificProtocol.protocol.updated_at)," "),r(2),l("innerHTML",T(11,4,t.specificProtocol.protocol.description),M),r(2),I(t.currentQuestionArr)}}var Z=(()=>{class o{constructor(){this.actionTriggeredA=new H,this.currentQuestionArr=[]}displayFirstQuestion(){let t=this.specificProtocol.protocol.questions[0];this.currentQuestionArr.push(t)}onDisplayNextQuestionChange(t){let e=this.specificProtocol.protocol.questions.find(i=>i.id===t);e&&this.currentQuestionArr.push(e)}onCheckPreviousQuestionCheck(t){let e=this.currentQuestionArr.indexOf(t);if(e!==-1){let i=this.currentQuestionArr.splice(e+1);console.log(i),i.forEach(n=>{n.choices.forEach(d=>{document.querySelectorAll(`[for="${d.id}"]`).forEach(S=>{let tt=S.previousSibling;tt.checked=!1})})})}}updateChart(t){this.actionTriggeredA.emit({id:t})}onChangeMoving(){setTimeout(()=>{console.log(this.Question.last.nativeElement),this.Question.last.nativeElement.scrollIntoView({behavior:"smooth",block:"nearest"})},0)}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275cmp=C({type:o,selectors:[["app-patient-history-radio-charts"]],viewQuery:function(e,i){if(e&1&&(g(it,5),g(ot,5)),e&2){let n;_(n=y())&&(i.Questions__Description=n.first),_(n=y())&&(i.Question=n)}},inputs:{History:"History",specificProtocol:"specificProtocol",currentQuestionArr:"currentQuestionArr"},outputs:{actionTriggeredA:"actionTriggeredA"},standalone:!0,features:[w],decls:1,vars:1,consts:[["Questions__Description",""],["Question",""],["id","Questions__Container",1,"position-relative","z-1"],["id","Questions__Description"],[1,"card","mb-2"],[1,"card-body","rounded-0"],[1,"lastUpdated__text"],[1,"pi","pi-history"],[3,"innerHTML"],["id","Questions__Choices"],[1,"form-check"],["type","radio",1,"form-check-input",3,"change","id","value","name"],[1,"form-check-label",3,"for"]],template:function(e,i){e&1&&P(0,at,14,6,"div",2),e&2&&A(0,i.specificProtocol?0:-1)},dependencies:[V,Y],styles:["body{overflow-y:hidden}[_nghost-%COMP%]{height:calc(100% - 56px);overflow-y:auto}.lastUpdated__text[_ngcontent-%COMP%], .lastUpdated__text[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{text-align:right;font-size:14px;color:#757575;line-height:24px;margin-bottom:1rem}.card-body[_ngcontent-%COMP%]{background-color:#e8f5fc;border:2px solid #409bd2;padding:16px;position:relative}.card[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_Animation__Card 1s forwards}@keyframes _ngcontent-%COMP%_Animation__Card{0%{transform:translateY(10px);opacity:0}to{transform:translateY(0);opacity:1}}"]})}}return o})();var ct=["componentB"],dt=["componentA"],lt=()=>({height:"90vh"}),pt=()=>[50,50];function ut(o,u){if(o&1){let t=x();a(0,"div",13)(1,"div")(2,"div",14)(3,"app-patient-history-flow-charts",15,1),f("actionTriggeredB",function(i){h(t);let n=c(2);return m(n.handleActionB(i))}),s()()()()}if(o&2){let t=c(2);r(3),l("specificProtocol",t.specificProtocol)("currentQuestionArr",t.currentQuestionArr)}}function ht(o,u){if(o&1){let t=x();a(0,"div",6)(1,"div",7)(2,"div",8)(3,"app-patient-history-radio-charts",9,0),f("actionTriggeredA",function(i){h(t);let n=c(2);return m(n.handleActionA(i))}),s(),a(5,"div",10)(6,"button",16),f("click",function(){h(t);let i=c(2);return m(i.copy())}),p(7,"i",12),b(8," copy Assessment "),s()()()()()}if(o&2){let t=c(2);r(3),l("History",t.History)("specificProtocol",t.specificProtocol)("currentQuestionArr",t.currentQuestionArr),r(3),l("disabled",t.isDisabled)}}function mt(o,u){if(o&1){let t=x();a(0,"div",2)(1,"p-splitter",3),P(2,ut,5,2,"ng-template",4)(3,ht,9,4,"ng-template",4),s()(),a(4,"div",5)(5,"div",6)(6,"div",7)(7,"div",8)(8,"app-patient-history-radio-charts",9,0),f("actionTriggeredA",function(i){h(t);let n=c();return m(n.handleActionA(i))}),s(),a(10,"div",10)(11,"button",11),f("click",function(){h(t);let i=c();return m(i.copy())}),p(12,"i",12),b(13," copy Assessment "),s()()()()()()}if(o&2){let t=c();r(),N(q(7,lt)),l("panelSizes",q(8,pt)),r(7),l("History",t.History)("specificProtocol",t.specificProtocol)("currentQuestionArr",t.currentQuestionArr),r(3),l("disabled",t.isDisabled)}}var Jt=(()=>{class o{constructor(t,e,i,n,d){this._ActivatedRoute=t,this._SpecificProtocolService=e,this._HistoryProtocolsService=i,this._PLATFORM_ID=n,this._ToastrService=d,this.isDisabled=!1,this.currentQuestionArr=[]}ngOnInit(){this.getUserHistoryDetails(),this.handleGetCurrentCategoryId(),this.getCurrentCategory()}handleActionB(t){this.getHistory()}handleActionA(t){}handleGetCurrentCategoryId(){this._ActivatedRoute.paramMap.subscribe({next:t=>{this.protocolId=t.get("id")}})}getCurrentCategory(){this._SpecificProtocolService.getSpecificProtocol(this.protocolId).subscribe({next:t=>{this.specificProtocol=t,console.log(t)},error:t=>{console.log(t)}})}getUserHistoryDetails(){z(this._PLATFORM_ID)&&(this.PatientData=JSON.parse(localStorage.getItem("PatientData")),this.getHistory())}getHistory(){console.log(this.componentA),console.log(this.componentB),this._HistoryProtocolsService.getPatientHistory(this.PatientData).subscribe({next:t=>{this.History=t,this.filterHistory(),console.log(this.componentA),console.log(this.componentA.startNode()),this.componentA.renderChart()}})}filterHistory(){this.currentQuestionArr=this.History.Historys.map(e=>e.question);let t=this.History.Historys.map(e=>e.question).map(e=>e.id);t.forEach(e=>{console.log(e);let i={id:e}}),console.log(t,"================================"),this.checkAllInputs()}checkAllInputs(){console.log(this.History,"from radio button"),setTimeout(()=>{this.History.Historys.forEach(t=>{console.log(t.choice_id),document.querySelector(`[for="${t.choice_id}"]`).click()}),document.querySelectorAll("input").forEach(t=>{t.setAttribute("disabled","true")})},2e3)}ngOnDestroy(){this._HistoryProtocolsService.History.next(null),localStorage.removeItem("PatientData")}copy(){let t=document.querySelector("#Questions__Description")?.lastElementChild;navigator.clipboard.writeText(t.innerText),this._ToastrService.success("Assessment Copied")}static{this.\u0275fac=function(e){return new(e||o)(v(L),v(U),v(G),v(D),v($))}}static{this.\u0275cmp=C({type:o,selectors:[["app-patient-history-questions"]],viewQuery:function(e,i){if(e&1&&(g(ct,5),g(dt,5)),e&2){let n;_(n=y())&&(i.componentB=n.first),_(n=y())&&(i.componentA=n.first)}},standalone:!0,features:[w],decls:1,vars:1,consts:[["componentB",""],["componentA",""],[1,"card","d-none","d-lg-block","h"],["styleClass","mb-5 ",3,"panelSizes"],["pTemplate",""],[1,"card",2,"height","100vh","padding-top","120px"],[1,"col","flex","align-items-center","justify-content-center","h-100"],[1,"h-100"],[1,"Questions__Container","p-2","bg-white","h-100","w-100","overflow-hidden","d-flex","flex-column","justify-content-end"],[3,"actionTriggeredA","History","specificProtocol","currentQuestionArr"],[2,"background-color","#ededed","height","56px"],["id","responsive_copy",1,"btn","btn-main","m-2","rounded-0","d-none",3,"click","disabled"],[1,"pi","pi-copy"],[1,"col","flex","align-items-center","justify-content-center"],[1,"p-2","bg-white","h-100","w-100"],[3,"actionTriggeredB","specificProtocol","currentQuestionArr"],["id","copy",1,"btn","btn-main","m-2","rounded-0","d-none",3,"click","disabled"]],template:function(e,i){e&1&&P(0,mt,14,9),e&2&&A(0,i.History&&i.specificProtocol?0:-1)},dependencies:[W,J,j,K,Z],styles:[".card[_ngcontent-%COMP%]{padding-top:80px;background-color:#ededed}  .p-splitter-gutter.ng-star-inserted{padding:5px;background-color:#ededed;background-image:url(/assets/sizeable.png);background-position:center center;background-repeat:no-repeat}  .p-splitter-gutter-handle{display:none}  #resizable{min-width:100px;min-height:100px;background-color:#ededed;position:relative}  .resizable-box{width:100%;height:150px;background-color:#ededed;resize:both;overflow:auto;border:1px solid black}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{transition:background-color .3s cubic-bezier(.4,0,.2,1);transition:color .3s cubic-bezier(.4,0,.2,1);transition-delay:0ms;transition-property:color,background-color,border;appearance:none;background-color:#007ac3;border:.0625rem solid transparent;border-radius:0;box-sizing:border-box;color:#fff;display:inline-block;font-size:.875rem;font-weight:400;line-height:1.29;padding:.625rem 1rem;-webkit-tap-highlight-color:transparent;text-align:center;touch-action:manipulation;vertical-align:middle}"]})}}return o})();export{Jt as PatientHistoryQuestionsComponent};
